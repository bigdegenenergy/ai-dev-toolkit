# ⚠️ REVIEW INSTRUCTIONS

> Generated by Gemini

```json
{
  "review": {
    "summary": "The PR introduces significant AI capabilities but contains critical bugs in how git context is handled for comment-triggered workflows (checking out default branch instead of PR). A temporary review artifact was also accidentally included.",
    "decision": "REQUEST_CHANGES"
  },
  "issues": [
    {
      "id": 1,
      "severity": "critical",
      "file": ".github/workflows/claude.yml",
      "line": 0,
      "title": "Incorrect Git Context for PR Comments",
      "description": "The workflow is triggered by `issue_comment`, but `actions/checkout` defaults to the repository's default branch (or the workflow file's commit) when running in this context. If a user comments on a Pull Request, the agent will attempt to apply changes or analyze code on `main` (or the default branch) rather than the PR branch, leading to incorrect modifications or analysis of stale code.",
      "suggestion": "Add logic to determine if the comment is on a PR. If so, configure `actions/checkout` to use the PR reference: `ref: refs/pull/${{ github.event.issue.number }}/head`."
    },
    {
      "id": 2,
      "severity": "critical",
      "file": ".github/workflows/claude-research-implement.yml",
      "line": 0,
      "title": "Incorrect Git Context for Research/Implement Workflows",
      "description": "Similar to `claude.yml`, this workflow is triggered by comments. When running `@claude research` or `@claude implement` on a Pull Request, the workflow must check out the specific PR branch to analyze or modify the relevant code. Currently, it defaults to the main branch context.",
      "suggestion": "Implement conditional checkout logic to fetch `refs/pull/${{ github.event.issue.number }}/head` when the trigger event involves a Pull Request."
    },
    {
      "id": 3,
      "severity": "important",
      "file": "REVIEW_INSTRUCTIONS.md",
      "line": 1,
      "title": "Accidental Inclusion of Review Artifact",
      "description": "This file appears to be a generated report or instruction set for the review process itself (possibly generated by an AI agent), rather than documentation intended for the repository. It highlights bugs that seem to exist in the current PR.",
      "suggestion": "Remove this file from the repository."
    },
    {
      "id": 4,
      "severity": "important",
      "file": ".github/mcp-config.json.template",
      "line": 0,
      "title": "Unpinned Package Execution (Supply Chain Risk)",
      "description": "The template uses `npx -y` to execute packages (e.g., `@modelcontextprotocol/server-github`). This executes the latest version available at runtime, bypassing version control and exposing the environment to potential supply chain attacks or breaking changes.",
      "suggestion": "Pin specific versions in the command templates (e.g., `npx -y @modelcontextprotocol/server-github@1.0.0`) to ensure stability and security."
    }
  ]
}
```