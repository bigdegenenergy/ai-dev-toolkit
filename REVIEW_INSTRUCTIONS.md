# ⚠️ REVIEW INSTRUCTIONS

> Generated by Gemini

```toml
[review]
summary = "The PR introduces a high-risk 'human-in-the-loop' AI workflow with critical security vulnerabilities. The implementation allows for Remote Code Execution (RCE) via untrusted script execution (Pwn Request) and contains a script injection vulnerability via branch names. These must be fixed before merging to prevent credential theft and repository compromise."
decision = "REQUEST_CHANGES"

[[issues]]
severity = "critical"
file = ".github/workflows/claude-code-implement.yml"
line = 45
title = "RCE via Untrusted Script Execution (Pwn Request)"
description = "The workflow checks out the PR branch (`ref: ${{ env.PR_BRANCH }}`) and immediately executes a script contained within it (`node .github/scripts/claude-code-implement.js`). A malicious actor can open a PR that modifies this script to exfiltrate `ANTHROPIC_API_KEY` or `GH_TOKEN`, then trigger the workflow by commenting `/implement`. This grants the attacker full access to repository secrets and write permissions."
suggestion = "Do not execute scripts directly from the PR branch. 1) Checkout the default branch (trusted) to a separate directory (e.g., `./_scripts`) to retrieve the tooling. 2) Checkout the PR branch to the working directory. 3) Execute the trusted script path: `node _scripts/.github/scripts/claude-code-implement.js`."

[[issues]]
severity = "critical"
file = ".github/workflows/pr-review-prompt.yml"
line = 25
title = "JavaScript Injection via Branch Name"
description = "The workflow uses string interpolation to insert the branch name into a `github-script` block: `const branch = '${{ steps.pr.outputs.pr_branch }}';`. If a malicious branch name contains a single quote (e.g., `fix'; process.exit(1);//`), it breaks the string literal and executes arbitrary JavaScript in the runner context."
suggestion = "Pass the branch name via the `env` block of the `uses: actions/github-script` step and access it securely using `process.env.PR_BRANCH`."

[[issues]]
severity = "important"
file = ".github/workflows/claude-code-implement.yml"
line = 48
title = "Unsafe Dynamic Dependency Installation"
description = "Running `npm install @anthropic-ai/claude-code` in the root of the checked-out PR branch allows malicious `preinstall`/`postinstall` scripts defined in a modified `package.json` to execute. This provides another vector for RCE."
suggestion = "Use `npm install ... --ignore-scripts` or install the tool in a temporary directory outside the repository root. Preferably, define the SDK version in the main repository's `package.json` to prevent supply chain attacks via floating versions."

[[issues]]
severity = "important"
file = ".github/scripts/claude-code-implement.js"
line = 1
title = "Excessive Agent Permissions (Bash)"
description = "The AI agent is initialized with the `Bash` tool, granting it ability to execute arbitrary shell commands. Since `USER_INSTRUCTIONS` are injected into the prompt, a prompt injection attack could trick the AI into executing destructive commands or exfiltrating environment variables."
suggestion = "Remove the generic `Bash` tool. If the agent needs to run tests or specific commands, wrap them in restricted, specific tool functions (e.g., `runTests()`) that do not allow arbitrary shell execution."

[[issues]]
severity = "suggestion"
file = ".github/workflows/claude-code-implement.yml"
line = 10
title = "Missing Access Control on Trigger"
description = "The workflow triggers on `issue_comment`. Without explicit checks on `author_association` (e.g., OWNER, MEMBER), any user (including the PR author) might be able to trigger the AI agent, incurring API costs and potentially modifying code."
suggestion = "Add a condition to the job or step to verify that the comment author has write access or maintainer status before running the expensive and privileged AI agent."
```