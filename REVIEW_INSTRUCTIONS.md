# ⚠️ REVIEW INSTRUCTIONS

> Generated by Gemini

```toml
[review]
summary = "This PR introduces a Critical Security Vulnerability allowing unauthorized users to trigger implementation actions, and a Syntax Error that will cause the workflow to fail immediately. \n\nAdditionally, there is a contradiction between the commit messages (stating reaction triggers don't work and prompt was changed to commands) and the code (which adds reaction detection logic). This suggests the codebase is in an inconsistent state."
decision = "REQUEST_CHANGES"

[[issues]]
severity = "critical"
file = ".github/workflows/claude-code-implement.yml"
line = 0
title = "Syntax Error: Duplicate variable declaration in github-script"
description = "The variable `comments` is declared twice within the same scope in the `github-script` step. The added code block declares `const comments = ...` (or similar) to fetch comments for reaction checking, while the existing code below it also likely declares `const { data: comments } = ...`. This will throw a `SyntaxError: Identifier 'comments' has already been declared` and fail the workflow."
suggestion = "Rename the new variable (e.g., `const promptComments`) or reuse the existing declaration if the logic flow permits."

[[issues]]
severity = "critical"
file = ".github/workflows/claude-code-implement.yml"
line = 0
title = "Security Vulnerability: Authorization Bypass via `context.actor`"
description = "The added logic checks if `context.actor` (the user triggering the workflow) has reacted with a thumbs-up: `const actorThumbsUp = reactions.find(r => r.user.login === context.actor)`. If true, it sets `is_accept = true`. \n\nSince this workflow is likely triggered by `issue_comment`, `context.actor` is simply the person commenting. An unauthorized user (attacker) could react to the bot's prompt and then comment on the PR to trigger this workflow. The code would identify them as the 'actor', find their reaction, and authorize the action, bypassing the explicit `OWNER`/`MEMBER` checks."
suggestion = "Remove the check for `actorThumbsUp` or ensure `context.actor` is cross-referenced against the authorized user list (`OWNER`, `MEMBER`, or `CLAUDE_CODE_USER`) before accepting their reaction as valid authorization."

[[issues]]
severity = "important"
file = ".github/workflows/claude-code-implement.yml"
line = 0
title = "Inconsistent Logic vs Commit Messages"
description = "The commit message 'fix: remove debug logging and fix misleading reaction prompt' states that GitHub Actions doesn't support reaction triggers and changes the prompt to use `/accept`. However, the workflow still adds significant logic to detect reactions. If reaction-based triggering is abandoned, this code is dead weight and increases complexity/risk. If it is intended as a 'react then comment' flow, it creates a confusing UX compared to the slash commands."
suggestion = "If moving to slash commands (e.g., `/accept`), remove the reaction detection logic entirely to simplify the workflow and reduce attack surface."
```